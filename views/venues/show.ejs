<div class="container">
  <br/>
  <div class="columns">
    <div class="column">
      <figure class="image">
        <img src="<%= venue.image %>" alt="<%= venue.name %>">
      </figure>
    </div>
    <div class="column">
      <h1 class="title"><%= venue.name %> (<%= venue.category.charAt(0).toUpperCase() + venue.category.slice(1); %>)</h1>
      <h2 class="subtitle"><%= venue.location %>, <%= venue.postCode %></h2>
      <p class="subtitle"><%= venue.phone %></p>
      <p class="subtitle">Open <%= venue.openingHours['seasons'] %></p>
      <table>
        <tr>
          <td></td>
          <td>Open</td>
          <td>Close</td>
        </tr>
        <% days.forEach(day => { %>
          <tr>
            <td><%- day.charAt(0).toUpperCase() + day.slice(1); %>&nbsp; &nbsp; &nbsp;</td>
            <td><%= venue.openingHours[day][0] %></td>
            <td><%= venue.openingHours[day][1] %></td>
          </tr>
        <% }) %>
      </table>
    </div>
  </div>
  <div class="columns">
    <p><%- venue.description %></p>
  </div>
  <div class="columns">
    <%# set attributes as 'data-whatever' to access in javascript by document.getElement().dataset.whatever
    here we've used JSON.stringify to turn the object into a string (which we will then JSON.parse in JavaScript) %>
    <div id="map" data-location="<%= JSON.stringify(venue.map) %>"></div>
  </div>

  <% if(locals.isAuthenticated) { %>
    <div class="columns">
      <a class="button is-primary" href="/venues/<%= venue._id %>/edit">Edit</a>
      <form method="POST" action="/venues/<%= venue._id %>">
        <input type="hidden" name="_method" value="DELETE">
        <button class="button is-danger">Delete</button>
      </form>
    </div>
    <hr/>
  <ul class="comments">
    <% venue.comments.forEach(comment => { %>
      <li>
      <div class="box">
      <% if (comment.isOwnedBy(locals.currentUser) || locals.currentUser.isAdmin) { %>
        <form class="delete" method="POST" action="/venues/<%= venue._id %>/comments/<%= comment._id %>">
          <input type="hidden" name="_method" value="DELETE">
          <button class="delete">x</button>
        </form>
        <% } %> 

        <% if(locals.currentUser.isAdmin && !comment.isModerated) { %>
                <form class="moderate" method="POST" action="/venues/<%= venue._id %>/comments/<%= comment._id %>/moderate">
                  <input type="hidden" name="_method" value="PATCH">
                  <button class="moderate">Moderate</button>
                </form>
            <% } %>

        <% if(comment.isModerated || locals.currentUser.isAdmin || comment.isOwnedBy(locals.currentUser)) { %>
        <article class="media">
          <div class="media-left">
            <figure class="image is-64x64">
              <img src="https://bulma.io/images/placeholders/128x128.png" alt="Image">
            </figure>
          </div>
          <div class="media-content">
            <div class="content">
              <p>
                <%= comment.content %>
              </p>
              <% if (comment.user) { %>
                <strong><%= comment.user.username %><strong>
              <% } %>
            </div>
          </div>
        </article>
        <% } %>

        </div>
      </li>
    <% }) %>
  </ul>
  <form method="POST" action="/venues/<%= venue._id %>/comments">
        <textarea class="textarea" name="content"></textarea>
        <button class="button is-primary">Submit</button>
  </form>
  <% } %>
  <div class="columns">
    <p>Visit this venue's website <strong><a href="<%= venue.website %>">here</a></strong></p>
  </div>
</div>
